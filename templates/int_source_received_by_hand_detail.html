{% extends "base.html" %}
{% block content %}
<style>
.received-by-hand-detail-container {
  max-width: 900px;
  margin: 2rem auto;
  padding: 0 1rem;
}
.detail-card {
  background: white;
  border-radius: 1rem;
  box-shadow: 0 4px 20px rgba(0,0,0,0.08);
  overflow: hidden;
  margin-bottom: 1.5rem;
}
.detail-header {
  background: linear-gradient(135deg, #2e8bfa 0%, #0a2540 100%);
  color: white;
  padding: 1.5rem 2rem;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.detail-body {
  padding: 2rem;
}
.info-row {
  display: grid;
  grid-template-columns: 180px 1fr;
  gap: 1rem;
  padding: 0.75rem 0;
  border-bottom: 1px solid #f0f0f0;
}
.info-label {
  font-weight: 600;
  color: #555;
}
.info-value {
  color: #333;
}
.score-badge {
  display: inline-block;
  padding: 0.5rem 1rem;
  border-radius: 2rem;
  font-weight: 600;
  font-size: 1.1em;
}
.score-high { background: #d4edda; color: #155724; }
.score-medium { background: #fff3cd; color: #856404; }
.score-low { background: #f8d7da; color: #721c24; }
.document-list {
  list-style: none;
  padding: 0;
  margin: 0;
}
.document-item {
  background: #f8f9fa;
  padding: 1rem;
  border-radius: 0.5rem;
  margin-bottom: 0.75rem;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.document-icon {
  font-size: 2rem;
  margin-right: 1rem;
}
.btn-actions {
  display: flex;
  gap: 0.5rem;
  flex-wrap: wrap;
}
</style>

<div class="received-by-hand-detail-container">
  
  <!-- Header Card -->
  <div class="detail-card">
    <div class="detail-header">
      <div>
        <h3 class="mb-1">
          <i class="bi bi-hand-thumbs-up-fill"></i>
          Received by Hand Entry #{{ entry.id }}
        </h3>
        {% if entry.int_reference %}
        <span class="badge bg-light text-dark">{{ entry.int_reference }}</span>
        {% endif %}
      </div>
      <div class="btn-actions">
        <a href="{{ url_for('int_source') }}" class="btn btn-light btn-sm">
          <i class="bi bi-arrow-left"></i> Back
        </a>
      </div>
    </div>
  </div>

  <!-- Main Information Card -->
  <div class="detail-card">
    <div class="detail-body">
      <h5 class="mb-3">
        <i class="bi bi-info-circle"></i> Entry Information
      </h5>
      
      <div class="info-row">
        <div class="info-label">Entry ID:</div>
        <div class="info-value"><strong>#{{ entry.id }}</strong></div>
      </div>
      
      <div class="info-row">
        <div class="info-label">Received Time:</div>
        <div class="info-value">
          {% if entry.received_time %}
            {{ entry.received_time.strftime('%Y-%m-%d %H:%M') }}
          {% else %}
            <em class="text-muted">Not specified</em>
          {% endif %}
        </div>
      </div>
      
      <div class="info-row">
        <div class="info-label">Complaint Name:</div>
        <div class="info-value">{{ entry.complaint_name or '-' }}</div>
      </div>
      
      <div class="info-row">
        <div class="info-label">Contact Number:</div>
        <div class="info-value">{{ entry.contact_number or '-' }}</div>
      </div>
      
      <div class="info-row">
        <div class="info-label">Source / How Received:</div>
        <div class="info-value">
          <span class="badge bg-info">{{ entry.source or 'Not specified' }}</span>
        </div>
      </div>
      
      <div class="info-row">
        <div class="info-label">Alleged Person(s):</div>
        <div class="info-value">{{ entry.alleged_person or '-' }}</div>
      </div>
      
      <div class="info-row">
        <div class="info-label">Alleged Type:</div>
        <div class="info-value">{{ entry.alleged_type or '-' }}</div>
      </div>
      
      <div class="info-row">
        <div class="info-label">Details:</div>
        <div class="info-value">
          <div style="white-space: pre-wrap;">{{ entry.details or '-' }}</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Assessment Card -->
  <div class="detail-card">
    <div class="detail-body">
      <h5 class="mb-3">
        <i class="bi bi-clipboard-check"></i> Assessment
      </h5>
      
      <div class="info-row">
        <div class="info-label">Source Reliability:</div>
        <div class="info-value">
          {% if entry.source_reliability %}
            <span class="score-badge {% if entry.source_reliability >= 5 %}score-high{% elif entry.source_reliability >= 3 %}score-medium{% else %}score-low{% endif %}">
              {{ entry.source_reliability }} / 6
            </span>
          {% else %}
            <em class="text-muted">Not assessed</em>
          {% endif %}
        </div>
      </div>
      
      <div class="info-row">
        <div class="info-label">Content Validity:</div>
        <div class="info-value">
          {% if entry.content_validity %}
            <span class="score-badge {% if entry.content_validity >= 5 %}score-high{% elif entry.content_validity >= 3 %}score-medium{% else %}score-low{% endif %}">
              {{ entry.content_validity }} / 6
            </span>
          {% else %}
            <em class="text-muted">Not assessed</em>
          {% endif %}
        </div>
      </div>
      
      <div class="info-row">
        <div class="info-label">Combined Score:</div>
        <div class="info-value">
          {% if entry.source_reliability and entry.content_validity %}
            {% set combined = entry.source_reliability + entry.content_validity %}
            <span class="score-badge {% if combined >= 10 %}score-high{% elif combined >= 6 %}score-medium{% else %}score-low{% endif %}">
              {{ combined }} / 12
            </span>
            {% if combined >= 8 %}
              <span class="badge bg-success ms-2">Substantial</span>
            {% endif %}
          {% else %}
            <em class="text-muted">Not assessed</em>
          {% endif %}
        </div>
      </div>
      
      <div class="info-row">
        <div class="info-label">Preparer:</div>
        <div class="info-value">{{ entry.preparer or '-' }}</div>
      </div>
      
      <div class="info-row">
        <div class="info-label">Reviewer:</div>
        <div class="info-value">{{ entry.reviewer_name or '-' }}</div>
      </div>
      
      {% if entry.reviewer_comment %}
      <div class="info-row">
        <div class="info-label">Reviewer Comment:</div>
        <div class="info-value">
          <div style="white-space: pre-wrap;">{{ entry.reviewer_comment }}</div>
        </div>
      </div>
      {% endif %}
      
      <div class="info-row">
        <div class="info-label">Case Status:</div>
        <div class="info-value">
          {% if entry.intelligence_case_opened %}
            <span class="badge bg-danger">Case Opened</span>
          {% else %}
            <span class="badge bg-secondary">Pending</span>
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  <!-- Documents Card -->
  <div class="detail-card">
    <div class="detail-body">
      <h5 class="mb-3">
        <i class="bi bi-file-earmark-text"></i> 
        Attached Documents ({{ documents|length }})
      </h5>
      
      {% if documents %}
        <ul class="document-list">
          {% for doc in documents %}
          <li class="document-item">
            <div class="d-flex align-items-center">
              <i class="bi bi-file-earmark-{{ doc.file_type }}-fill document-icon text-primary"></i>
              <div>
                <strong>{{ doc.filename }}</strong><br>
                <small class="text-muted">
                  Uploaded: {{ doc.uploaded_at.strftime('%Y-%m-%d %H:%M') }}
                  | Type: {{ doc.file_type.upper() }}
                </small>
              </div>
            </div>
            <a href="{{ url_for('received_by_hand_document_download', document_id=doc.id) }}" 
               class="btn btn-primary btn-sm">
              <i class="bi bi-download"></i> Download
            </a>
          </li>
          {% endfor %}
        </ul>
      {% else %}
        <div class="alert alert-info">
          <i class="bi bi-info-circle"></i>
          No documents attached to this entry.
        </div>
      {% endif %}
    </div>
  </div>

  <!-- Action Buttons -->
  <div class="detail-card">
    <div class="detail-body">
      <div class="d-flex gap-2 flex-wrap">
        <a href="{{ url_for('int_source') }}" class="btn btn-secondary">
          <i class="bi bi-arrow-left"></i> Back to Intelligence Source
        </a>
        <form method="post" action="{{ url_for('delete_received_by_hand', entry_id=entry.id) }}" 
              onsubmit="return confirm('Are you sure you want to delete this entry? This cannot be undone.');" 
              style="display: inline;">
          <button type="submit" class="btn btn-danger">
            <i class="bi bi-trash"></i> Delete Entry
          </button>
        </form>
      </div>
    </div>
  </div>

</div>

{% endblock %}
