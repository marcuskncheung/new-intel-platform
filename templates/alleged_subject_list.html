{% extends "base.html" %}
{% block content %}
<h2>Alleged Subjects Dashboard</h2>
<p>
  {% if automation_enabled %}
    {# New automated profile system #}
    <a href="{{ url_for('create_alleged_person_profile') }}" class="btn btn-success">+ New POI Profile</a>
  {% else %}
    {# Old legacy profile system #}
    <a href="{{ url_for('create') }}" class="btn btn-success">+ New Profile</a>
  {% endif %}
</p>
<div class="row">
  {% for t in targets %}
  <div class="col-md-4 mb-3">
    <div class="card h-100">
      <div class="card-body d-flex flex-column">
        <h5 class="card-title">{{ t.label }}</h5>
        {% if t.subtitle %}<p class="text-muted">{{ t.subtitle }}</p>{% endif %}
        {% if t.time %}
          <div class="mb-2"><span class="badge bg-light text-dark">Time: {{ t.time }}</span></div>
        {% endif %}
        <div class="mt-auto d-flex justify-content-between align-items-center">
          {% if automation_enabled and t.poi_id %}
            {# New automated profile system #}
            <a href="{{ url_for('view_alleged_person_profile', profile_id=t.idx) }}" class="btn btn-primary btn-sm">View</a>
            <form method="post" action="{{ url_for('delete_alleged_person_profile', profile_id=t.idx) }}"
                  onsubmit="return confirm('⚠️ Delete profile {{ t.poi_id }}?\n\nThis will remove:\n- Profile information\n- All linked allegations\n\nThe emails will remain in the system.\n\nAre you sure?')"
                  style="margin: 0;">
              <button class="btn btn-danger btn-sm" type="submit">
                <i class="bi bi-trash"></i> Delete
              </button>
            </form>
          {% else %}
            {# Old legacy profile system #}
            <a href="{{ url_for('details', idx=t.idx) }}" class="btn btn-primary btn-sm">View</a>
            <form method="post" action="{{ url_for('delete', idx=t.idx) }}"
                  onsubmit="return confirm('Delete this profile?')">
              <button class="btn btn-danger btn-sm">Delete</button>
            </form>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
  {% endfor %}
</div>
{% endblock %}
